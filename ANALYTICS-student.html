<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„çŸ¥è­˜ç¾…ç›¤ | My KB Journey</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f3f4f6; }
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); padding: 1.5rem; }
        .kb-badge { font-size: 0.75rem; padding: 0.25rem 0.5rem; border-radius: 9999px; font-weight: 600; }
        
        /* æƒ³æ³•æ¼”åŒ–è»Œè·¡çš„é€£ç·šæ¨£å¼ */
        .evolution-line {
            position: absolute;
            left: 20px;
            top: 40px;
            bottom: -20px;
            width: 2px;
            background-color: #e5e7eb;
            z-index: 0;
        }
        .evolution-item:last-child .evolution-line { display: none; }
        
        /* ç¤¾ç¾¤æ¨å‹•åŠ›çš„æ¼£æ¼ªå‹•ç•«æ•ˆæœ */
        @keyframes ripple {
            0% { box-shadow: 0 0 0 0 rgba(96, 165, 250, 0.4); }
            100% { box-shadow: 0 0 0 20px rgba(96, 165, 250, 0); }
        }
        .ripple-effect {
            animation: ripple 2s infinite;
        }
        
        /* ç¶²çµ¡ç¯€é»å‹•ç•« */
        @keyframes pulse-node {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .node-pulse { animation: pulse-node 2s infinite ease-in-out; }

        /* ç°¡å–®çš„æ·¡å…¥å‹•ç•« */
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* èªªæ˜æ–‡å­—å€å¡Šæ¨£å¼ */
        .insight-box {
            background-color: #f8fafc;
            border-left: 3px solid #cbd5e1;
            padding: 0.75rem;
            margin-top: 1rem;
            font-size: 0.75rem; /* text-xs */
            color: #64748b; /* text-slate-500 */
            line-height: 1.4;
        }
        .insight-title {
            font-weight: 700;
            color: #475569;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }
        .insight-title i { margin-right: 0.25rem; }

        /* Modal Styles - Mobile Optimized */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.5); 
            backdrop-filter: blur(2px);
            align-items: center;
            justify-content: center;
            padding: 1rem; /* Add padding for mobile */
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 0;
            border-radius: 12px;
            width: 100%; /* Full width on mobile */
            max-width: 500px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            animation: modalFadeIn 0.3s;
            max-height: 90vh; /* Max height for mobile */
            display: flex;
            flex-direction: column;
        }
        @keyframes modalFadeIn {
            from {opacity: 0; transform: scale(0.95);}
            to {opacity: 1; transform: scale(1);}
        }
        .modal-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f9fafb;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            flex-shrink: 0; /* Header stays fixed */
        }
        .modal-body {
            padding: 1.5rem;
            overflow-y: auto; /* Scrollable body */
        }
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            padding: 0 0.5rem; /* Bigger touch target */
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        /* Ref Button Style */
        .ref-btn {
            color: #9ca3af; /* text-gray-400 */
            background-color: #f3f4f6; /* bg-gray-100 */
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem; /* text-xs */
            display: inline-flex;
            align-items: center;
            transition: all 0.2s;
            margin-left: 0.5rem;
            cursor: pointer;
        }
        .ref-btn:hover {
            color: #4f46e5; /* text-indigo-600 */
            background-color: #e0e7ff; /* bg-indigo-50 */
        }
        /* Dark mode compatible ref button for Community Impact card */
        .ref-btn-dark {
            color: #94a3b8; /* text-slate-400 */
            background-color: rgba(255,255,255,0.1);
        }
        .ref-btn-dark:hover {
            color: white;
            background-color: rgba(255,255,255,0.2);
        }
        
        /* New: Tiny Ref Button for Role Cards */
        .ref-btn-mini {
             position: absolute;
             top: 4px;
             right: 4px;
             font-size: 0.65rem;
             padding: 2px 6px;
             color: #cbd5e1;
             background: transparent;
             cursor: pointer;
        }
        .ref-btn-mini:hover {
            color: #6366f1;
            background: #f1f5f9;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- é ‚éƒ¨å°èˆª -->
    <nav class="bg-indigo-600 text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 py-3 sm:py-4 flex flex-col sm:flex-row justify-between items-center gap-3 sm:gap-0">
            <div class="flex items-center space-x-3 w-full sm:w-auto justify-center sm:justify-start">
                <i class="fas fa-compass text-2xl"></i>
                <div>
                    <h1 class="text-lg sm:text-xl font-bold">çŸ¥è­˜ç¾…ç›¤ Knowledge Compass</h1>
                    <p class="text-xs text-indigo-200 hidden sm:block">å¾Œè¨­èªçŸ¥èˆ‡æˆé•·æ­·ç¨‹ (Student Portfolio)</p>
                </div>
            </div>
            <div class="flex items-center space-x-2 sm:space-x-4 w-full sm:w-auto justify-center sm:justify-end overflow-x-auto pb-1 sm:pb-0">
                <div class="flex items-center gap-2 mr-2">
                    <a href="index.html" class="nav-btn bg-indigo-700 hover:bg-indigo-500 px-2 sm:px-3 py-1.5 rounded text-xs font-bold transition flex items-center gap-1 border border-indigo-500 whitespace-nowrap">
                        <i class="fas fa-home"></i> <span class="hidden sm:inline">é¦–é </span>
                    </a>
                    <a href="Knowledge Building Forum.html" class="nav-btn bg-indigo-700 hover:bg-indigo-500 px-2 sm:px-3 py-1.5 rounded text-xs font-bold transition flex items-center gap-1 border border-indigo-500 whitespace-nowrap">
                        <i class="fas fa-comments"></i> <span class="hidden sm:inline">è«–å£‡</span>
                    </a>
                    <button onclick="syncData()" id="sync-btn" class="nav-btn bg-emerald-600 hover:bg-emerald-500 px-2 sm:px-3 py-1.5 rounded text-xs font-bold transition flex items-center gap-1 border border-emerald-500 whitespace-nowrap">
                        <i class="fas fa-sync-alt"></i> <span class="hidden sm:inline">åˆ·æ–°</span>
                    </button>
                </div>
                <div class="text-right hidden md:block">
                    <span class="block font-bold" id="user-name">è¨ªå®¢</span>
                    <span class="text-xs text-indigo-200">å­¸ç¿’è€…</span>
                </div>
                <img id="current-user-avatar" src="https://ui-avatars.com/api/?name=User&background=random" class="w-8 h-8 sm:w-10 sm:h-10 rounded-full border-2 border-white flex-shrink-0">
                <div id="nav-user-select-container"></div>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å…§å®¹å€ -->
    <main class="container mx-auto px-4 sm:px-6 py-6 sm:py-8 space-y-6 sm:space-y-8 fade-in pb-20">

        <!-- ========================================== -->
        <!-- æ¨¡çµ„ 1: ä½¿ç”¨è€…çŸ¥è­˜è§’è‰² -->
        <!-- ========================================== -->
        <section class="card bg-gradient-to-r from-white to-blue-50 border border-blue-100 relative overflow-hidden">
             <!-- èƒŒæ™¯è£é£¾ -->
             <div class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-blue-100 rounded-full opacity-50 blur-2xl pointer-events-none"></div>

             <div class="flex flex-col md:flex-row items-center gap-6 sm:gap-8 relative z-10">
                 <!-- å·¦å´ï¼šè§’è‰²ç¨±è™Ÿ -->
                 <div class="w-full md:w-1/3 text-center md:text-left md:border-r border-gray-200 md:pr-8">
                     <div class="flex items-center justify-center md:justify-start mb-3">
                        <h2 class="text-xs font-bold text-gray-500 uppercase tracking-widest">
                            <i class="fas fa-user-tag mr-1"></i> æˆ‘çš„çŸ¥è­˜è§’è‰²
                        </h2>
                        <button onclick="openRefModal('roles')" class="ref-btn" title="äº†è§£è§’è‰²å®šç¾©">
                            <i class="fas fa-info-circle mr-1"></i> Ref.
                        </button>
                     </div>
                     <div class="flex items-center justify-center md:justify-start gap-5">
                         <div class="w-16 h-16 sm:w-20 sm:h-20 bg-indigo-600 rounded-full flex items-center justify-center text-white text-2xl sm:text-3xl shadow-xl ripple-effect flex-shrink-0">
                             <div id="user-avatar-large" class="text-xl sm:text-2xl font-bold">?</div>
                         </div>
                         <div>
                             <h3 class="text-xl sm:text-2xl font-bold text-indigo-900" id="role-title">æ¢ç´¢è€…</h3>
                             <p class="text-xs sm:text-sm text-indigo-600 font-medium" id="role-subtitle">The Knowledge Explorer</p>
                         </div>
                     </div>
                     <div class="mt-4 bg-white/60 p-3 rounded-lg text-sm text-gray-600 leading-relaxed border border-white text-left" id="role-desc">
                         <i class="fas fa-quote-left text-indigo-300 mr-1"></i>
                         æ­£åœ¨åˆ†æä½ çš„ç™¼è¨€æ¨¡å¼...
                     </div>
                 </div>
                 
                 <!-- å³å´ï¼šå››ç¨®èƒ½åŠ›æŒ‡æ¨™ (Dynamic) -->
                 <div class="w-full md:w-2/3">
                     <div class="grid grid-cols-2 gap-3 sm:gap-4">
                         <!-- èƒ½åŠ› 1: é–‹å‰µåŠ› -->
                         <div class="bg-white p-3 sm:p-4 rounded-xl shadow-sm border border-gray-100 text-center hover:shadow-md transition relative">
                             <button onclick="openRefModal('initiator')" class="ref-btn-mini"><i class="fas fa-info-circle"></i></button>
                             <div class="text-gray-400 text-[10px] sm:text-xs mb-1">é–‹å‰µåŠ› (Initiator)</div>
                             <div class="text-base sm:text-lg font-bold text-gray-800" id="role-initiator-val">--%</div>
                             <div class="w-full bg-gray-100 rounded-full h-1.5 mt-2">
                                 <div class="bg-blue-400 h-1.5 rounded-full" id="role-initiator-bar" style="width: 0%"></div>
                             </div>
                         </div>
                         <!-- èƒ½åŠ› 2: é€£çµåŠ› -->
                         <div class="bg-white p-3 sm:p-4 rounded-xl shadow-sm border border-gray-100 text-center hover:shadow-md transition relative">
                             <button onclick="openRefModal('builder')" class="ref-btn-mini"><i class="fas fa-info-circle"></i></button>
                             <div class="text-gray-400 text-[10px] sm:text-xs mb-1">é€£çµåŠ› (Builder)</div>
                             <div class="text-base sm:text-lg font-bold text-gray-800" id="role-builder-val">--%</div>
                             <div class="w-full bg-gray-100 rounded-full h-1.5 mt-2">
                                 <div class="bg-indigo-600 h-1.5 rounded-full" id="role-builder-bar" style="width: 0%"></div>
                             </div>
                         </div>
                         <!-- èƒ½åŠ› 3: æ•´åˆåŠ› -->
                         <div class="bg-white p-3 sm:p-4 rounded-xl shadow-sm border border-gray-100 text-center hover:shadow-md transition relative">
                             <button onclick="openRefModal('synthesizer')" class="ref-btn-mini"><i class="fas fa-info-circle"></i></button>
                             <div class="text-gray-400 text-[10px] sm:text-xs mb-1">æ•´åˆåŠ› (Synthesizer)</div>
                             <div class="text-base sm:text-lg font-bold text-gray-800" id="role-synthesizer-val">--%</div>
                             <div class="w-full bg-gray-100 rounded-full h-1.5 mt-2">
                                 <div class="bg-purple-400 h-1.5 rounded-full" id="role-synthesizer-bar" style="width: 0%"></div>
                             </div>
                         </div>
                         <!-- èƒ½åŠ› 4: ç¶­è­·åŠ› -->
                         <div class="bg-white p-3 sm:p-4 rounded-xl shadow-sm border border-gray-100 text-center hover:shadow-md transition relative">
                             <button onclick="openRefModal('sustainer')" class="ref-btn-mini"><i class="fas fa-info-circle"></i></button>
                             <div class="text-gray-400 text-[10px] sm:text-xs mb-1">ç¶­è­·åŠ› (Sustainer)</div>
                             <div class="text-base sm:text-lg font-bold text-gray-800" id="role-sustainer-val">--%</div>
                             <div class="w-full bg-gray-100 rounded-full h-1.5 mt-2">
                                 <div class="bg-green-400 h-1.5 rounded-full" id="role-sustainer-bar" style="width: 0%"></div>
                             </div>
                         </div>
                     </div>
                     <!-- èªªæ˜ -->
                     <div class="insight-box bg-white/50 border-blue-200 mt-4 text-[10px] sm:text-xs">
                         <div class="insight-title text-blue-800 text-xs sm:text-sm"><i class="fas fa-info-circle"></i> è§’è‰²åˆ†æèªªæ˜</div>
                         é€™äº›æŒ‡æ¨™åæ˜ äº†ä½ åœ¨ç¤¾ç¾¤ä¸­çš„å‹•æ…‹è²¢ç»ã€‚æ•¸å€¼æ˜¯æ ¹æ“šä½ ç›¸å°æ–¼å…¨ç­å¹³å‡çš„è¡¨ç¾è¨ˆç®—å¾—å‡ºçš„ç›¸å°å¼·åº¦ (0-100%)ã€‚
                     </div>
                 </div>
             </div>
        </section>

        <!-- 2. æ ¸å¿ƒæ•¸æ“šæ¦‚è¦½ (Core Metrics) WITH REF BUTTONS -->
        <section class="grid grid-cols-2 md:grid-cols-4 gap-4 sm:gap-6">
            <!-- Card 1 -->
            <div class="card border-l-4 border-blue-500 py-4 group hover:shadow-lg transition relative">
                <button onclick="openRefModal('created')" class="absolute top-2 right-2 ref-btn"><i class="fas fa-info-circle mr-1"></i> Ref.</button>
                <h3 class="text-gray-500 text-[10px] sm:text-xs font-medium uppercase">æˆ‘çš„è²¢ç» (Created)</h3>
                <div class="mt-1 flex items-baseline">
                     <span class="text-xl sm:text-2xl font-bold text-gray-900" id="card-created-val">0</span>
                </div>
            </div>
            
            <!-- Card 2 -->
            <div class="card border-l-4 border-green-500 py-4 group hover:shadow-lg transition relative">
                <button onclick="openRefModal('read')" class="absolute top-2 right-2 ref-btn"><i class="fas fa-info-circle mr-1"></i> Ref.</button>
                <h3 class="text-gray-500 text-[10px] sm:text-xs font-medium uppercase">é–±è®€ä»–äºº (Read)</h3>
                <div class="mt-1 text-xl sm:text-2xl font-bold text-gray-900" id="card-read-val">0</div>
            </div>
            
            <!-- Card 3 -->
            <div class="card border-l-4 border-purple-500 py-4 group hover:shadow-lg transition relative">
                <button onclick="openRefModal('buildon')" class="absolute top-2 right-2 ref-btn"><i class="fas fa-info-circle mr-1"></i> Ref.</button>
                <h3 class="text-gray-500 text-[10px] sm:text-xs font-medium uppercase">è§€é»é€£çµ (Build-ons)</h3>
                <div class="mt-1 text-xl sm:text-2xl font-bold text-gray-900" id="card-buildon-val">0</div>
            </div>
            
            <!-- Card 4 -->
            <div class="card border-l-4 border-yellow-500 py-4 group hover:shadow-lg transition relative">
                <button onclick="openRefModal('impact')" class="absolute top-2 right-2 ref-btn"><i class="fas fa-info-circle mr-1"></i> Ref.</button>
                <h3 class="text-gray-500 text-[10px] sm:text-xs font-medium uppercase">å½±éŸ¿ä¿‚æ•¸ (Impact)</h3>
                <div class="mt-1 text-xl sm:text-2xl font-bold text-gray-900" id="card-impact-val">0</div>
            </div>
        </section>

        <!-- 3. åœ–è¡¨åˆ†æå€ -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- å·¦å´ï¼šKB è¡Œç‚ºé›·é” -->
            <div class="card col-span-1 lg:col-span-1 flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-slate-700 flex items-center"><i class="fas fa-chart-radar text-indigo-500 mr-2"></i> çŸ¥è­˜äº”åŠ›åˆ†æ</h3>
                    <button onclick="openRefModal('radar')" class="ref-btn"><i class="fas fa-info-circle mr-1"></i> Ref.</button>
                </div>
                <div class="flex-1 min-h-[250px] relative">
                    <canvas id="studentRadarChart"></canvas>
                </div>
            </div>

            <!-- å³å´ï¼šæœ€è¿‘çš„æƒ³æ³•æ¼”åŒ– (Timeline) -->
            <div class="card col-span-1 lg:col-span-2">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-slate-700 flex items-center"><i class="fas fa-code-branch text-emerald-500 mr-2"></i> æœ€è¿‘çš„æ€è€ƒè»Œè·¡</h3>
                    <div class="flex items-center gap-2">
                         <a href="Knowledge Building Forum.html" class="text-xs text-indigo-600 hover:underline font-bold mr-2 hidden sm:inline">å»è«–å£‡å›æ‡‰ ></a>
                         <button onclick="openRefModal('evolution')" class="ref-btn"><i class="fas fa-info-circle mr-1"></i> Ref.</button>
                    </div>
                </div>
                <div class="relative pl-4 space-y-0" id="evolution-timeline">
                    <!-- å‹•æ…‹ç”Ÿæˆå…§å®¹ -->
                </div>
            </div>
        </div>

        <!-- 4. é·¹æ¶èˆ‡ AI å»ºè­° -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-slate-700 flex items-center"><i class="fas fa-tools text-orange-500 mr-2"></i> æ€è€ƒé·¹æ¶åå¥½</h3>
                    <button onclick="openRefModal('scaffold')" class="ref-btn"><i class="fas fa-info-circle mr-1"></i> Ref.</button>
                </div>
                <div class="flex items-end gap-2 h-40" id="scaffold-bars"></div>
                <div class="flex justify-between text-xs text-slate-500 mt-2 px-1">
                    <span>æå•</span><span>å»¶ä¼¸</span><span>æ”¹é€²</span><span>åé§</span><span>æ˜‡è¯</span>
                </div>
            </div>

            <div class="card border-l-4 border-indigo-500 bg-indigo-50/50">
                <h3 class="font-bold text-indigo-900 mb-3 flex items-center"><i class="fas fa-robot text-indigo-600 mr-2"></i> ä¾†è‡ª AI å°å¸«çš„å»ºè­°</h3>
                <div id="ai-feedback" class="text-sm text-slate-700 space-y-4 leading-relaxed">
                    <p><i class="fas fa-circle-notch fa-spin text-indigo-400 mr-2"></i> æ­£åœ¨åˆ†æä½ çš„å­¸ç¿’æ­·ç¨‹...</p>
                </div>
                <div class="mt-4 text-right">
                    <button class="text-xs bg-white border border-indigo-200 px-3 py-1 rounded-full text-indigo-600 hover:bg-indigo-50 transition font-bold" onclick="refreshAIFeedback()">
                        <i class="fas fa-magic mr-1"></i> æ›´æ–°å»ºè­°
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 5. é€²éšæŒ‡æ¨™ (New Sections based on requests) -->
        <section class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- è©å½™æ¼”åŒ– -->
            <div class="card relative overflow-hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-bold text-gray-800 flex items-center"><i class="fas fa-spell-check text-purple-600 mr-2"></i>èªç¾©èˆ‡è©å½™æ·±åº¦</h2>
                    <button onclick="openRefModal('lexical')" class="ref-btn"><i class="fas fa-info-circle mr-1"></i> Ref.</button>
                </div>
                <div class="space-y-6">
                    <div class="flex justify-between items-center relative">
                        <div class="text-center w-1/3 opacity-60">
                            <div class="text-xs text-gray-500 font-bold mb-2">åˆå§‹éšæ®µ (Initial)</div>
                            <div class="space-y-1 text-sm text-gray-400">
                                <div><i class="fas fa-comment mr-1"></i> æˆ‘è¦ºå¾—...</div>
                                <div><i class="fas fa-comment mr-1"></i> å¥½åƒæ˜¯...</div>
                            </div>
                        </div>
                        <div class="text-center text-purple-300"><i class="fas fa-long-arrow-alt-right text-3xl"></i></div>
                        <div class="text-center w-1/3">
                            <div class="text-xs text-purple-600 font-bold mb-2">ç•¶å‰éšæ®µ (Current)</div>
                            <div class="space-y-1 text-sm font-bold text-purple-800">
                                <div><i class="fas fa-check mr-1"></i> ç†è«–é¡¯ç¤º...</div>
                                <div><i class="fas fa-check mr-1"></i> è­‰æ“šæ”¯æŒ...</div>
                            </div>
                        </div>
                    </div>
                    <div class="insight-box bg-purple-50 border-purple-200 text-purple-900">
                         <div class="insight-title text-purple-800"><i class="fas fa-book"></i> å­¸è¡“è©å½™åˆ†æ</div>
                         æ­¤æŒ‡æ¨™è¿½è¹¤ä½ å¾ä½¿ç”¨ã€Œæ—¥å¸¸èªè¨€ã€è½‰å‘ã€Œå°ˆæ¥­è¡“èªã€çš„éç¨‹ã€‚
                    </div>
                </div>
            </div>

            <!-- çŸ¥è­˜ç¶²çµ¡ -->
            <div class="card relative overflow-hidden bg-slate-800 text-white border-0">
                <div class="flex justify-between items-center mb-6 relative z-10">
                    <h2 class="text-lg font-bold flex items-center"><i class="fas fa-project-diagram text-blue-400 mr-2"></i>çŸ¥è­˜ç¶²çµ¡ä½ç½®</h2>
                    <button onclick="openRefModal('network')" class="ref-btn ref-btn-dark"><i class="fas fa-info-circle mr-1"></i> Ref.</button>
                </div>
                <div class="relative h-32 w-full flex items-center justify-center">
                     <div class="absolute w-2/3 h-0.5 bg-gray-600"></div>
                     <!-- Simulated Node -->
                     <div class="absolute z-10 flex flex-col items-center node-pulse">
                        <div class="w-12 h-12 rounded-full bg-blue-500 border-4 border-slate-900 flex items-center justify-center font-bold">You</div>
                        <span class="text-xs mt-2 text-blue-200" id="network-role-label">Broker (ä»²ä»‹è€…)</span>
                    </div>
                     <!-- Simulated Connections -->
                     <div class="absolute left-1/4 w-8 h-8 rounded-full bg-slate-600 flex items-center justify-center text-xs opacity-50">A</div>
                     <div class="absolute right-1/4 w-8 h-8 rounded-full bg-slate-600 flex items-center justify-center text-xs opacity-50">B</div>
                </div>
                <div class="mt-4 text-[10px] text-gray-300 bg-gray-800/80 p-3 rounded border border-gray-700 relative z-10">
                    <strong><i class="fas fa-share-alt"></i> ç¤¾ç¾¤æ¨å‹•åŠ› (Community Impact)ï¼š</strong>
                    é€™é¡¯ç¤ºäº†ä½ çš„æƒ³æ³•åœ¨ç¤¾ç¾¤ä¸­æ¿€ç™¼äº†å¤šå°‘æ¼£æ¼ªã€‚ä½œç‚º <strong>Broker</strong>ï¼Œä½ é€£çµäº†ä¸åŒçš„å°çµ„è¨è«–ã€‚
                </div>
            </div>
        </section>

        <!-- New: Advanced KB Indicators (Request 2) -->
        <section class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="card">
                 <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-slate-700 flex items-center"><i class="fas fa-lightbulb text-yellow-500 mr-2"></i> è§€é»å¤šæ¨£æ€§ (Idea Diversity)</h3>
                    <button onclick="openRefModal('diversity')" class="ref-btn"><i class="fas fa-info-circle mr-1"></i> Ref.</button>
                </div>
                <div class="text-sm text-gray-600">
                    ç›®å‰ä½ åƒèˆ‡äº† <span class="font-bold text-indigo-600" id="topic-count-val">0</span> å€‹ä¸åŒçš„ä¸»é¡Œè¨è«–ã€‚
                    <div class="w-full bg-gray-100 rounded-full h-2 mt-2">
                         <div class="bg-yellow-400 h-2 rounded-full" id="topic-diversity-bar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
             <div class="card">
                 <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-slate-700 flex items-center"><i class="fas fa-road text-blue-500 mr-2"></i> èªçŸ¥è·¯å¾‘é•·åº¦ (Path Length)</h3>
                    <button onclick="openRefModal('path_length')" class="ref-btn"><i class="fas fa-info-circle mr-1"></i> Ref.</button>
                </div>
                <div class="text-sm text-gray-600">
                    ä½ çš„è¨è«–ä¸²å¹³å‡æ·±åº¦ç‚º <span class="font-bold text-indigo-600" id="avg-depth-val">0</span> å±¤ã€‚
                    <div class="w-full bg-gray-100 rounded-full h-2 mt-2">
                         <div class="bg-blue-400 h-2 rounded-full" id="avg-depth-bar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </section>

    </div>

    <!-- Note Detail Modal (NEW) -->
    <div id="note-detail-modal" class="modal" onclick="closeModalDirect(event, 'note-detail-modal')">
        <div class="modal-content max-w-lg">
            <div class="modal-header bg-indigo-50">
                <h3 class="text-lg font-bold text-indigo-900 flex items-center"><i class="fas fa-sticky-note mr-2"></i> ç™¼è¨€è©³æƒ…</h3>
                <button onclick="document.getElementById('note-detail-modal').style.display='none'" class="text-slate-400 hover:text-slate-600 transition"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="modal-body">
                <div class="mb-4">
                    <span id="nd-type" class="text-xs font-bold px-2 py-1 rounded bg-slate-200 text-slate-700 uppercase">TYPE</span>
                    <span id="nd-date" class="text-xs text-slate-400 ml-2">YYYY-MM-DD</span>
                </div>
                <h2 id="nd-title" class="text-xl font-bold text-slate-800 mb-4">æ¨™é¡Œè¼‰å…¥ä¸­...</h2>
                <div id="nd-content" class="text-slate-600 leading-relaxed bg-slate-50 p-4 rounded-lg border border-slate-100 whitespace-pre-wrap">å…§å®¹è¼‰å…¥ä¸­...</div>
                <div class="mt-4 flex items-center justify-end">
                    <span class="text-xs text-slate-400 mr-2">Author:</span>
                    <span id="nd-author" class="text-sm font-bold text-slate-700 bg-slate-100 px-2 py-1 rounded">User</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Ref Modal Structure -->
    <div id="refModal" class="modal" onclick="closeModalDirect(event, 'refModal')">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="font-bold text-lg text-slate-800 flex items-center gap-2"><i class="fas fa-book-open text-indigo-500"></i> <span id="modalTitle">æ•¸æ“šè§£æ</span></h3>
                <span class="close" onclick="document.getElementById('refModal').style.display='none'">&times;</span>
            </div>
            <div class="modal-body space-y-5">
                <!-- 1. ç†è«–èƒŒæ™¯ -->
                <div>
                    <h4 class="text-xs font-bold text-blue-600 uppercase tracking-widest mb-2 flex items-center"><i class="fas fa-graduation-cap mr-2"></i> (1) çŸ¥è­˜å»ºæ§‹ç†è«–èƒŒæ™¯</h4>
                    <div class="text-sm text-slate-700 bg-blue-50 p-3 rounded-lg border border-blue-100 leading-relaxed" id="modalTheory"></div>
                </div>
                <!-- 2. æ•¸æ“šè¨ºæ–· -->
                <div>
                    <h4 class="text-xs font-bold text-yellow-600 uppercase tracking-widest mb-2 flex items-center"><i class="fas fa-lightbulb mr-2"></i> (2) ğŸ’¡ æ•¸æ“šè¨ºæ–·èˆ‡æ•™å­¸å°å¼•</h4>
                    <div class="text-sm text-slate-700 bg-yellow-50 p-3 rounded-lg border border-yellow-100 leading-relaxed" id="modalInsight"></div>
                </div>
                <!-- 3. ç›®å‰ç‹€æ³ -->
                <div>
                    <h4 class="text-xs font-bold text-green-600 uppercase tracking-widest mb-2 flex items-center"><i class="fas fa-chart-pie mr-2"></i> (3) ç›®å‰çš„ç‹€æ³ (æ•¸æ“š)</h4>
                    <div class="text-sm text-slate-700 bg-green-50 p-3 rounded-lg border border-green-100 font-mono font-bold" id="modalStatus"></div>
                </div>
                <!-- 4. å­¸è¡“å¼•ç”¨ -->
                <div class="pt-4 border-t border-slate-100">
                    <h4 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1 flex items-center"><i class="fas fa-quote-right mr-2"></i> (4) ğŸ“š å­¸è¡“åƒè€ƒä¾†æº</h4>
                    <p class="text-xs text-slate-500 italic" id="modalRef"></p>
                </div>
            </div>
        </div>
    </div>

   <script type="module">
    // 1. å¼•å…¥ Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // 2. è¨­å®š (è·Ÿä¸Šé¢ä¸€æ¨£)
    const firebaseConfig = {
          apiKey: "AIzaSyDPjtxtf656JHVVlj1o4cLwSylo1jDBFAc",
  authDomain: "kb-platform-1.firebaseapp.com",
  databaseURL: "https://kb-platform-1-default-rtdb.firebaseio.com",
  projectId: "kb-platform-1",
  storageBucket: "kb-platform-1.firebasestorage.app",
  messagingSenderId: "230026226847",
  appId: "1:230026226847:web:49e6f09ddfc3de0ef046aa"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dbRef = ref(db, 'kb_forum_data_v1');

    // 3. æ›¿æ›æ‰åŸæœ¬çš„ window.onload èˆ‡ getRealData
    onValue(dbRef, (snapshot) => {
        const cloudData = snapshot.val();
        if (cloudData) {
            console.log("åˆ†ææ•¸æ“šå·²åŒæ­¥");
            // é€™è£¡ç›´æ¥å‘¼å«æ‚¨åŸæœ¬çš„åˆ†æå‡½å¼
            // é‡å° Student é é¢ï¼š
            if (typeof initUserSwitcher === 'function') initUserSwitcher(cloudData);
            
            // é‡å° Teacher é é¢ï¼š
            if (typeof initOverview === 'function') {
                renderStudentSidebar(cloudData);
                initOverview(cloudData);
                switchView('overview');
                document.getElementById('db-status-text').innerText = "Connected (Cloud)";
                document.getElementById('db-status-text').className = "text-green-400 font-bold";
            }
        }
    });
</script>
</body>
</html>
